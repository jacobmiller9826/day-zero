<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Day Zero: Phoenix</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Rubik+Distressed&display=swap');
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      background: #000;
      font-family: 'Rubik Distressed', cursive;
      color: #fff8e1;
      touch-action: manipulation;
    }
    canvas {
      display: block;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 0;
    }
    #narration {
      position: fixed;
      bottom: 60px;
      width: 100%;
      text-align: center;
      font-size: clamp(1.2rem, 2.5vw, 2.5rem);
      padding: 0 20px;
      z-index: 10;
      text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.7);
      opacity: 1;
      transition: opacity 1s ease;
      pointer-events: none;
    }
    #choices {
      position: fixed;
      bottom: 20px;
      width: 100%;
      display: flex;
      justify-content: center;
      gap: 10px;
      z-index: 11;
    }
    .choice-btn {
      background: rgba(0, 0, 0, 0.5);
      border: 2px solid #fff8e1;
      color: #fff8e1;
      font-size: 1rem;
      padding: 10px 16px;
      font-family: inherit;
      cursor: pointer;
      border-radius: 4px;
      transition: background 0.3s;
    }
    .choice-btn:hover {
      background: rgba(255, 255, 255, 0.1);
    }
  </style>
</head>
<body>
<canvas id="canvas"></canvas>
<div id="narration">The taps run dry. 5 million people are still here.</div>
<div id="choices"></div>

<script>
(() => {
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const narration = document.getElementById('narration');
  const choicesDiv = document.getElementById('choices');

  let W = window.innerWidth;
  let H = window.innerHeight;
  canvas.width = W;
  canvas.height = H;

  function resize() {
    W = window.innerWidth;
    H = window.innerHeight;
    canvas.width = W;
    canvas.height = H;
  }
  window.addEventListener('resize', resize);

  let playerChoice = null;
  let flash = 0;
  let sceneIndex = 0;

  const scenes = [
    { id: 'intro1', text: "The taps run dry. 5 million people are still here.", bg: "#f5d27a" },
    { id: 'intro2', text: "The city panics. Shelves empty. Sirens echo.", bg: "#ff9966" },
    { id: 'decision', text: "What will you do?", bg: "#cc3300", choices: ["Flee", "Stay", "Organize"] },
    { id: 'flee1', text: "You flee. Highways choked. Cars idle under sun.", bg: "#e25822", path: "Flee" },
    { id: 'flee2', text: "Engine dies. You walk. Heat blurs the horizon.", bg: "#e65c00", path: "Flee" },
    { id: 'flee3', text: "A shimmer in the distance... Hope or hallucination?", bg: "#cc5200", path: "Flee", choices: ["Push forward", "Give up"] }
  ];

  const cars = Array.from({ length: 5 }, () => ({
    x: Math.random() * W,
    y: H * 0.75 + Math.random() * 30,
    speed: 1 + Math.random() * 1.5
  }));

  const walkers = Array.from({ length: 4 }, () => ({
    x: Math.random() * W,
    y: H * 0.7 + Math.random() * 40,
    speed: 0.5 + Math.random()
  }));

  function drawScene(time) {
    ctx.clearRect(0, 0, W, H);

    const scene = scenes[sceneIndex];
    const grad = ctx.createLinearGradient(0, 0, 0, H);
    grad.addColorStop(0, scene.bg || "#000");
    grad.addColorStop(1, "#1a0d00");
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, W, H);

    const sunX = W * 0.5;
    const sunY = H * 0.2;
    const sunPulse = 80 + Math.sin(time * 0.005) * 10;
    const sunGrad = ctx.createRadialGradient(sunX, sunY, 10, sunX, sunY, sunPulse);
    sunGrad.addColorStop(0, "#ffdd66");
    sunGrad.addColorStop(1, "rgba(255, 221, 102, 0)");
    ctx.fillStyle = sunGrad;
    ctx.beginPath();
    ctx.arc(sunX, sunY, sunPulse, 0, Math.PI * 2);
    ctx.fill();

    if (scene.id === "flee1") {
      cars.forEach(car => {
        ctx.fillStyle = "#444";
        ctx.fillRect(car.x, car.y, 40, 20);
        car.x += car.speed;
        if (car.x > W) car.x = -50;
      });
    }

    if (scene.id === "flee2") {
      walkers.forEach(walker => {
        ctx.fillStyle = "#222";
        ctx.fillRect(walker.x, walker.y, 10, 20);
        walker.x += walker.speed;
        if (walker.x > W) walker.x = -20;
      });
    }

    if (flash > 0) {
      ctx.fillStyle = `rgba(255,255,255,${flash})`;
      ctx.fillRect(0, 0, W, H);
      flash -= 0.02;
    }

    requestAnimationFrame(drawScene);
  }

  function updateScene() {
    const scene = scenes[sceneIndex];
    narration.textContent = scene.text;
    choicesDiv.innerHTML = "";

    if (scene.choices) {
      scene.choices.forEach(choice => {
        const btn = document.createElement('button');
        btn.textContent = choice;
        btn.className = 'choice-btn';
        btn.onclick = () => {
          if (scene.id === 'decision') {
            playerChoice = choice;
            sceneIndex++;
            updateScene();
          } else if (scene.id === 'flee3') {
            narration.textContent = choice === "Push forward"
              ? "You crawl toward the mirage. It's real. You survive."
              : "You sit. You wait. The desert takes you.";
            choicesDiv.innerHTML = "";
          }
        };
        choicesDiv.appendChild(btn);
      });
    }
  }

  function handleAdvance() {
    flash = 0.2;
    const scene = scenes[sceneIndex];
    if (!scene.choices) {
      sceneIndex++;
      while (sceneIndex < scenes.length && scenes[sceneIndex].path && scenes[sceneIndex].path !== playerChoice) {
        sceneIndex++;
      }
      if (sceneIndex < scenes.length) updateScene();
    }
  }

  canvas.addEventListener("click", handleAdvance);
  canvas.addEventListener("touchstart", (e) => { e.preventDefault(); handleAdvance(); }, { passive: false });

  updateScene();
  drawScene();
})();
</script>
</body>
</html>
